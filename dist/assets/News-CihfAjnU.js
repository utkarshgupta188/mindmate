import{c as E,u as q,r as s,j as t,m as b,A as D}from"./index-C4Srh_oV.js";import{S as $}from"./sparkles-DBi3gq2A.js";import{C as T}from"./clock-Df3tXyXE.js";import{G as y}from"./globe-C26lg9nG.js";import{F as L}from"./filter-uHSt3H5T.js";import{T as U}from"./triangle-alert-U25g7jNF.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=E("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),w=[{key:"uplifting",label:"Uplifting"},{key:"health",label:"Health"},{key:"science",label:"Science"},{key:"environment",label:"Environment"},{key:"education",label:"Education"},{key:"community",label:"Community"},{key:"business",label:"Business"},{key:"all",label:"All"}];function m(r){return r?`news:prefs:${r}`:"news:prefs:anon"}function B(){const{user:r}=q(),[p,h]=s.useState([]),[k,x]=s.useState(!0),[f,g]=s.useState(null),[l,j]=s.useState(!1),[n,v]=s.useState(()=>{try{return localStorage.getItem(m(r==null?void 0:r.email)+":category")||"uplifting"}catch{return"uplifting"}}),[d,S]=s.useState(!0),i=s.useRef(null),N=s.useMemo(()=>{var e;return((e=w.find(a=>a.key===n))==null?void 0:e.label)||"Uplifting"},[n]),C=s.useMemo(()=>l?"grid md:grid-cols-2 lg:grid-cols-3 gap-6":"grid md:grid-cols-1 lg:grid-cols-2 gap-8",[l]),A=!0;async function u(){x(!0),g(null);try{let e=[];if(A){const o=await fetch(`/api/news?category=${encodeURIComponent(n)}&limit=60`);if(!o.ok)throw new Error("Server news fetch failed");const c=await o.json();e=Array.isArray(c)?c:c.items||[]}e.sort((o,c)=>c.ts-o.ts);const a=e.slice(0,30);h(a);try{localStorage.setItem(m(r==null?void 0:r.email)+":cache",JSON.stringify(a))}catch{}fetch("/api/news/prefs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r==null?void 0:r.email,action:"news_refresh",category:n,ts:Date.now()})}).catch(()=>{})}catch(e){g((e==null?void 0:e.message)||"Failed to fetch news")}finally{x(!1)}}s.useEffect(()=>{try{const e=localStorage.getItem(m(r==null?void 0:r.email)+":cache");e&&h(JSON.parse(e))}catch{}u()},[n]),s.useEffect(()=>{if(!d){i.current&&window.clearInterval(i.current);return}return i.current=window.setInterval(u,10*60*1e3),()=>{i.current&&window.clearInterval(i.current)}},[d,n]);function I(e){v(()=>{try{localStorage.setItem(m(r==null?void 0:r.email)+":category",e)}catch{}return e})}const R=e=>{if(!e)return"";try{return new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch{return new Date(e).toLocaleString()}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs(b.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.35},className:"rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/70 dark:bg-slate-900/60 backdrop-blur p-4 md:p-6",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-tr from-indigo-500 to-cyan-500 text-white shadow",children:t.jsx($,{className:"h-5 w-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-xl",children:"Latest News"}),t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Category: ",N,". Served by the built-in server aggregator."]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:u,className:"text-xs rounded-full border px-3 py-1.5 inline-flex items-center gap-2",children:[t.jsx(F,{className:"h-3.5 w-3.5"})," Refresh"]}),t.jsxs("button",{onClick:()=>S(e=>!e),className:`text-xs rounded-full border px-3 py-1.5 inline-flex items-center gap-2 ${d?"bg-white/80 dark:bg-slate-950/40":""}`,"aria-pressed":d,children:[t.jsx(T,{className:"h-3.5 w-3.5"})," Auto"]}),t.jsxs("button",{onClick:()=>j(e=>!e),className:`text-xs rounded-full border px-3 py-1.5 inline-flex items-center gap-2 ${l?"bg-white/80 dark:bg-slate-950/40":""}`,"aria-pressed":l,title:l?"Compact view":"Comfortable view",children:[t.jsx(y,{className:"h-3.5 w-3.5"})," ",l?"Compact":"Comfortable"]})]})]}),t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:w.map(e=>t.jsxs("button",{onClick:()=>I(e.key),className:`text-xs rounded-full border px-3 py-1.5 inline-flex items-center gap-2 ${n===e.key?"bg-slate-900 text-white dark:bg-white dark:text-slate-900":"bg-white/70 dark:bg-slate-950/40"}`,children:[t.jsx(L,{className:"h-3.5 w-3.5"})," ",e.label]},e.key))})]}),t.jsx(D,{children:f&&t.jsx(b.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},className:"rounded-2xl border border-amber-300/40 bg-amber-50/70 text-amber-900 dark:border-amber-400/20 dark:bg-amber-950/30 dark:text-amber-200 p-4",children:t.jsxs("p",{className:"text-sm flex items-start gap-2",children:[t.jsx(U,{className:"h-4 w-4"})," ",f]})})}),t.jsx("div",{className:C,children:k&&!p.length?Array.from({length:6}).map((e,a)=>t.jsx("div",{className:"rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/60 dark:bg-slate-900/60 h-64 animate-pulse"},a)):p.map((e,a)=>t.jsxs("a",{href:e.link,target:"_blank",rel:"noreferrer noopener",className:"group rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/70 dark:bg-slate-900/60 backdrop-blur hover:shadow-lg hover:-translate-y-0.5 transition relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-forest-200/10 to-mint/10 dark:from-forest-900/10 dark:to-forest-800/10 pointer-events-none"}),t.jsx("div",{className:"relative w-full h-48 md:h-56 lg:h-64 bg-slate-100 dark:bg-slate-800",children:t.jsx("img",{src:e.img||`https://source.unsplash.com/960x540/?news,${encodeURIComponent(e.title.split(" ")[0]||"world")}`,alt:"",loading:"lazy",className:"absolute inset-0 w-full h-full object-cover",onError:o=>{o.currentTarget.src=`https://source.unsplash.com/960x540/?news,${encodeURIComponent(e.source)}`}})}),t.jsxs("div",{className:"p-4 md:p-5",children:[t.jsx("h3",{className:"font-semibold group-hover:underline line-clamp-2 text-base md:text-lg",children:e.title}),t.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 inline-flex items-center gap-1",children:[t.jsx(y,{className:"h-3.5 w-3.5"})," ",e.source," â€¢ ",t.jsx("span",{children:R(e.ts)})]}),e.snippet&&t.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-2 line-clamp-3",children:e.snippet})]})]},a))})]})}export{B as default};
