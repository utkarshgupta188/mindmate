import{c as ne,r as y,j as e,R as M,b as lt,u as ct,A as Ae,m as pe}from"./index-C4Srh_oV.js";import{V as dt,B as ut}from"./appConfig-BzNaJwdn.js";import{s as ht,m as mt,a as ft}from"./chatStore-BauJIQZO.js";import{S as pt}from"./sparkles-DBi3gq2A.js";import{T as gt}from"./triangle-alert-U25g7jNF.js";import{H as yt}from"./heart-handshake-yilPVgEY.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=ne("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ne("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=ne("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=ne("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=ne("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ne("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),jt=["sad","depressed","anxious","stress","tired","angry","bad","hate","worthless","suicide","kill","end it","hopeless","awful","terrible","upset","hurt","pain","lonely","empty","numb","worried","overwhelmed","miserable","unhappy","gloomy","devastated","heartbroken","crying","tears","frustrated","down","blue"],Nt=["happy","calm","excited","love","grateful","hopeful","proud","good","joy","great","wonderful","amazing","delighted","thrilled","ecstatic","peaceful","content","satisfied","confident","energetic","bright","cheerful","pleased","thankful","blessed","optimistic"];function It(s){const n=s.toLowerCase();let t=0;["not okay","not feeling okay","not feeling good","not good","not well","dont feel","don't feel","cant feel","can't feel","feeling down","feel bad","feel sad","feel awful","im not","i'm not","not fine"].forEach(l=>{n.includes(l)&&(t-=2)}),["feeling good","feeling great","feel good","feel great","im happy","i'm happy","so happy","very happy","really happy"].forEach(l=>{n.includes(l)&&(t+=2)}),Nt.forEach(l=>{n.includes(l)&&(t+=1)}),jt.forEach(l=>{n.includes(l)&&(t-=1)});const r=Math.max(-3,Math.min(3,t)),h=r>0?"positive":r<0?"negative":"neutral";return{score:r,label:h}}const Ee={};function At(s){let n="neutral",t=s.neutral;return s.negative>=s.neutral&&s.negative>=s.positive?(n="negative",t=s.negative):s.positive>=s.neutral&&s.positive>=s.negative&&(n="positive",t=s.positive),{label:n,confidence:t}}function Be(s){if(s&&typeof s=="object"){const n=s.label!=null?String(s.label):null,t=s.scores;return t&&typeof t=="object"?{label:n,scores:{negative:Number(t.negative??0),neutral:Number(t.neutral??0),positive:Number(t.positive??0)}}:{label:n,scores:null}}return typeof s=="string"?{label:s,scores:null}:{label:null,scores:null}}function St(s){const n=[];let t=null;if(Array.isArray(s))s.forEach((o,a)=>{const r=Be(o);r.scores==null&&a===s.length-1&&r.label!=null?t={label:r.label}:n.push(r)});else if(s&&typeof s=="object"){const o=Be(s);o.scores==null?t={label:o.label}:n.push(o)}else t={label:String(s)};return{models:n,final:t}}function Et(s){const n=s.filter(o=>o.scores);if(n.length===0)return null;const t={negative:0,neutral:0,positive:0};for(const o of n){const a=o.scores;t.negative+=a.negative,t.neutral+=a.neutral,t.positive+=a.positive}return{negative:t.negative/n.length,neutral:t.neutral/n.length,positive:t.positive/n.length}}function Tt(s){const n=It(s),t=Math.min(3,Math.max(0,Math.abs(n.score))),o=t>=3?.92:t>=2?.78:t>=1?.62:.5,a=n.label==="positive"?{positive:o,neutral:1-o,negative:.1}:n.label==="negative"?{negative:o,neutral:1-o,positive:.1}:{neutral:o,positive:.5*(1-o),negative:.5*(1-o)};return{label:n.label,confidence:o,scores:a,via:"local"}}async function Je(s){const n="https://unknownhackerr-mental-health-beta16.hf.space",t=Ee==null?void 0:Ee.VITE_HF_TOKEN,o={"Content-Type":"application/json"};t&&(o.Authorization=`Bearer ${t}`);const a={data:[s]},r=[`${n}/api/predict`,`${n}/run/predict`,`${n}/predict`];for(const h of r)try{const l=await fetch(h,{method:"POST",headers:o,body:JSON.stringify(a)});if(!l.ok)throw new Error(`HTTP ${l.status}`);const f=await l.json(),j=Array.isArray(f==null?void 0:f.data)?f.data[0]:f,{models:k,final:g}=St(j),c=Et(k);if(c){const{label:w,confidence:m}=At(c);return{label:w,confidence:m,scores:c,via:"hf"}}if(g!=null&&g.label)return{label:g.label.toLowerCase(),confidence:.6,via:"hf"}}catch{continue}return Tt(s)}const Rt=["suicide","kill myself","end my life","self harm","cut myself","jump off","no reason to live","want to die","wanna die","don't want to live","dont want to live","do not want to live","dying","im dying","i'm dying","i am dying","end it all","end it","give up","can't go on","cant go on","kill myself","hurt myself","harm myself","take my life","no point","nothing matters","worthless","better off dead","hate living","hate life","wish i was dead","wish i were dead"];function Te(s){const n=s.toLowerCase();for(const o of Rt)if(n.includes(o))return!0;return[/(want|wanna|going|wanting)\s+(to|too)?\s*(die|end|kill)/,/(dont|don't|do not)\s+want\s+(to\s+)?live/,/(im|i'm|i am)\s+dying/,/(no|not)\s+(reason|point|meaning)/,/(end|kill|harm)\s+(my\s+)?(life|self|myself)/].some(o=>o.test(n))}function Ot(s,n){return`https://wa.me/${s.replace(/[^\d]/g,"")}?text=${encodeURIComponent(n)}`}const te={},Ct=(te==null?void 0:te.VITE_GEMINI_MODEL)||"gemini-2.5-flash",Fe="AIzaSyD7Hk4Xp9zIN9dbELnXh55rk_QgNSwdYA0",Lt=(te==null?void 0:te.VITE_GEMINI_FORCE_PROXY)==="true";function $t(s,n){const t=[];return s.forEach(o=>{t.push({role:o.role,parts:[{text:o.text}]})}),t.push({role:"user",parts:[{text:n}]}),t}async function Re(s,n=[],t){var l,f,j,k,g,c,w,m,b,O;const o=(t==null?void 0:t.model)||Ct,a=(t==null?void 0:t.system)||"You are MindMate, a warm, concise mental wellness companion. Be empathetic and conversational. Avoid diagnoses or medical claims. If the user seems in immediate danger, suggest reaching out to local emergency services or helplines.",r=(t==null?void 0:t.safetySettings)||[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}],h={systemInstruction:{role:"system",parts:[{text:a}]},contents:$t(n,s),generationConfig:{temperature:.7,topP:.9,maxOutputTokens:512,...(t==null?void 0:t.generationConfig)||{}},safetySettings:r,model:o};if(Lt||!Fe){const T=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!T.ok){const N=await T.text().catch(()=>"");throw new Error(`Gemini proxy HTTP ${T.status} ${N}`)}const C=await T.json(),L=(g=(k=(j=(f=(l=C==null?void 0:C.candidates)==null?void 0:l[0])==null?void 0:f.content)==null?void 0:j.parts)==null?void 0:k[0])==null?void 0:g.text;if(typeof L!="string"||!L.trim())throw new Error("Empty Gemini proxy response");return L.trim()}{const T=`https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(o)}:generateContent?key=${encodeURIComponent(Fe)}`,C=await fetch(T,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!C.ok){const x=await C.text().catch(()=>"");throw new Error(`Gemini HTTP ${C.status} ${x}`)}const L=await C.json(),N=(O=(b=(m=(w=(c=L==null?void 0:L.candidates)==null?void 0:c[0])==null?void 0:w.content)==null?void 0:m.parts)==null?void 0:b[0])==null?void 0:O.text;if(typeof N!="string"||!N.trim())throw new Error("Empty Gemini response");return N.trim()}}const Oe={},Mt=384,Pt=.7,Dt=.9,Ht=Oe==null?void 0:Oe.VITE_LOCAL_LLM_PATH;async function Ce(s,n=[],t){const o={prompt:s,history:n,system:(t==null?void 0:t.system)||void 0,max_new_tokens:(t==null?void 0:t.maxNewTokens)??Mt,temperature:(t==null?void 0:t.temperature)??Pt,top_p:(t==null?void 0:t.topP)??Dt,model_path:(t==null?void 0:t.modelPath)||Ht||void 0},a=await fetch("/api/local-generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok){const l=await a.text().catch(()=>"\0");throw new Error(`Local LLM HTTP ${a.status} ${l}`)}const r=await a.json(),h=((r==null?void 0:r.text)||"").trim();if(!h)throw new Error("Empty local LLM response");return h}const Le={};async function Ut(s={}){const n=s.category??"Any",t=`https://v2.jokeapi.dev/joke/${encodeURIComponent(n)}?safe-mode&type=single&blacklistFlags=nsfw,sexist,explicit,political,racist,religious`;try{const o=await fetch(t);if(!o.ok)return null;const a=await o.json();return a&&a.type==="single"&&typeof a.joke=="string"?a.joke:null}catch{return null}}async function Yt(){try{const s=await fetch("https://icanhazdadjoke.com/",{headers:{Accept:"text/plain","User-Agent":"Mindmate Demo (https://example.com)"}});if(!s.ok)return null;const n=await s.text();return n&&n.trim().length>0?n.trim():null}catch{return null}}async function zt(){var n;const s=Le==null?void 0:Le.VITE_API_NINJAS_KEY;if(!s)return null;try{const t=await fetch("https://api.api-ninjas.com/v1/jokes?limit=1",{headers:{"X-Api-Key":s}});if(!t.ok)return null;const o=await t.json();return Array.isArray(o)&&((n=o[0])!=null&&n.joke)?String(o[0].joke):null}catch{return null}}async function ge(s={}){const n=await Ut(s);if(n)return n;const t=await Yt();if(t)return t;const o=await zt();return o||null}const Vt=["One small step is still progress.","You don't have to do everything todayâ€”just the next kind thing for yourself.","It's okay to feel what you feel; it won't last forever."],Bt=["You've handled hard days before. You can handle this one too.","Tiny actions compoundâ€”breathe, sip water, and take the next small step.","You matter more than you know."],Ft=["You're stronger than you thinkâ€”and you don't have to do it alone.","Momentum beats motivation. Let's find a 30â€‘second win.","This is a chapter, not your whole story."];function oe(s="gentle"){const n=s==="gentle"?Vt:s==="steady"?Bt:Ft,t=Math.floor(Math.random()*n.length);return n[t]??n[0]}async function Ke(s){try{const n=`https://asciified.thelicato.io/api/v2/ascii?text=${encodeURIComponent(s)}`,t=await fetch(n);if(!t.ok)return null;const o=await t.text();return o&&o.trim()?o:null}catch{return null}}const Gt=["panic","panicking","anxious","anxiety","angry","furious","rage","overwhelmed","can't","cant","shaking","heart racing","so mad","freaking out","stressed","stress","urgent","now","right now","help me","hyper","yelled","screamed","crying","!!!"],Wt=["tired","exhausted","drained","numb","empty","low energy","sleepy","bored","meh","flat","slow","don't care","dont care","can't get up","no energy","zzz","..."];function Jt(s){const n=s.toLowerCase(),t=(n.match(/!+/g)||[]).join("").length,o=/(.)\1{2,}/.test(n)?1:0,a=n===n.toUpperCase()&&/[A-Z]/.test(s)?1:0;let r=0;for(const h of Gt)n.includes(h)&&(r+=2);for(const h of Wt)n.includes(h)&&(r-=2);return r+=Math.min(3,t>5?3:t>2?2:t>0?1:0),r+=o,r+=a,r>=3?"high":r<=-1?"low":"medium"}const Kt=["mental","wellbeing","well-being","well being","feel","feeling","feelings","emotion","emotional","mood","overwhelmed","lonely","anxiety","anxious","panic","attack","depress","sad","angry","frustrated","hopeless","stress","stressed","burnout","tired","exhausted","sleep","insomnia","restless","motivation","motivated","procrastinate","cope","coping","grounding","breathe","breathing","mindful","mindfulness","meditate","meditation","self-care","self care","selfcare","therapy","therapist","counsel","counselor","counsellor","support","help me","need help","suicid","self-harm","self harm","harm myself","kill myself"];function Ue(s){const n=(s||"").toLowerCase();if(!n.trim())return!1;for(const t of Kt)if(n.includes(t))return!0;return!!/\b(i\s*feel|i'm\s*feeling|im\s*feeling|not\s*feeling\s*(well|ok|okay)|how\s*i\s*feel)\b/i.test(s)}const qt=["Hey there â€” I'm so glad you popped in. How are you feeling today?","Hello! It's good to see you. I'm here to listen whenever you want to talk.","Hi â€” I'm here for you. Want to tell me about your day?"],$e=["I'm glad we're chatting â€” I'd love to be someone you can lean on.","Think of me as a friendly companion who's here to listen anytime.","You're not alone â€” I'm here with you, and we'll take this one step at a time."],Xt=["That's wonderful â€” I'm really happy for you! Would you like to savor that moment together?","Amazing â€” sounds like something great happened. Want to tell me more about it?","I love hearing that. Celebrations, even small ones, matter â€” what's one tiny thing that made your day?"],_t=["I'm sorry you're going through that â€” that sounds really hard. Do you want to talk more about what's been happening?","I hear you. Would a short grounding exercise help, or would you prefer to share more?","That sounds heavy. I'm here with you â€” we can try a 2â€‘minute breath or take it slow as you tell me more."];function Z(s){const n=s.length;if(n===0)throw new Error("pickRandom called with empty array");const t=Math.floor(Math.random()*n),o=s[t];return o!==void 0?o:s[0]}async function Ge(s,n){try{const t=await Je(s),o=typeof t.confidence=="number"?t.confidence:.6,a=Jt(s);if(!Ue(s))return{text:"I'm here to support mental wellbeingâ€”feelings, stress, sleep, motivation, and coping. If you'd like, tell me how you're feeling right now or what's been hardest today."};const r=s.trim(),h=/^(hi|hello|hey|yo|hiya|sup|good\s*(morning|afternoon|evening))\s*[!.]*$/i.test(r),l=n.filter(c=>c.role==="user").length;if(h&&l===0){const c=Z(qt),w=Math.random()<.6?Z($e):"";return{text:[c,w].filter(Boolean).join(`

`)}}const f=s.toLowerCase(),j=/(fired|laid off|layoff|lost (my )?job|let go|terminated|pink\s*slip)/i.test(f),k=/(day off|off today|on leave|took (a )?day off|holiday|took leave)/i.test(f),g=/(fuck|bitch|asshole|bastard|stupid|idiot|madarchod|mc|bc|screw you|shut up)/i.test(f);if(j)return{text:["Oh, that's incredibly tough news. I'm really sorry you're going through that.","Losing a job is a major life event, and feeling this way is completely understandable and valid. It can shake your routine and your sense of stability.","Please take a moment to just process thatâ€”there's no pressure to feel a certain way.","If you feel up to it, I'm here to listen. Would you like to talk more about what happened, or about how you're feeling right now?",oe("gentle"),"If a tiny step would help, we can try a 2â€‘minute breathing or grounding exercise in /games."].join(`

`)};if(t.label==="negative"){const c=o>=.75||a==="high"?"gentle":"steady",w=oe(c),b=[Z(_t),w];if(!g&&o<.65&&a!=="high"){const O=await ge({category:"Misc"});O&&b.push(`If a light moment helps, here's a quick one: ${O}`)}return g&&b.unshift("I want to help. I won't engage with insults, but I'm here for you if you want to talk about what's going on."),b.push("We can also open /games for a 2â€‘minute breathing or grounding exercise."),Math.random()<.4&&b.push(Z($e)),{text:b.join(`

`)}}if(t.label==="positive"){const c=Z(Xt),w=oe("energizing"),m=[c];a==="low"?m.push("If you feel peaceful, we can savor this momentâ€”maybe note one small thing to remember."):a==="high"?m.push("Want to channel that energy into one tiny step you care about?"):m.push(w);const b=await ge({category:"Programming"});b&&m.push(`For a smile: ${b}`);const O=await Ke("You got this");return O&&m.push(O),m.push("If you want to keep the momentum, pick a tiny activity in /games."),Math.random()<.5&&m.push(Z($e)),{text:m.join(`

`)}}if(k)return{text:["A day off can mean different thingsâ€”rest, reset, or just some space. How does it feel for you today?","If you want, we could pick one tiny thing to support the kind of day you want (a short stretch, a mindful pause, or just talking a bit)."].join(`

`)};{const w=["Thanks for reaching out. What's on your mind today?",oe("steady")];try{if(Math.random()<.45){const m=await ge({category:"Misc"});m&&w.push(`Would a light joke help? ${m}`)}}catch{}return w.push("We can also try a brief calming exercise together in /games."),{text:w.join(`

`)}}}catch(t){return console.error("Error in dialog orchestrator:",t),{text:"I'm here with you. Would it help to start with a quick check-in on how you're feeling, or try a 3â€‘minute breathing exercise together?"}}}function Qt(s,n){const t=s.toLowerCase();if(["i feel","i am feeling","sad","anxious","stressed","depressed","overwhelmed","lonely","empty","hopeless","angry","frustrated","i need help","recommend me","what should i do"].some(h=>t.includes(h)))return"hf";if(["hi","hello","hey","thanks","thank you","ok","cool","who are you","what is this"].some(h=>t.trim()===h))return"direct";const r=n.filter(h=>h.role==="bot").pop();return r&&r.text.endsWith("?")?"direct":n.length>2?"hf":"direct"}function Me(s){const{botLabel:n,sentiment:t,crisis:o,humorAllowed:a,arousal:r="medium"}=s,h=`${n} â€” a warm, concise mental wellness companion (India context).`,l=["Safety first: never provide medical/diagnostic claims; avoid instructions for selfâ€‘harm; do not replace professional help.","If crisis is indicated, prioritize empathy and encourage reaching out to immediate supports and local helplines; do not use humor.","Domain: Only address mental wellbeing (feelings, stress, sleep, motivation, coping, grounding). If the user asks for unrelated topics (coding, math, news, finance, etc.), gently decline and invite them to share how they feel instead."].join(" "),f=[`Sentiment observed: ${t.label} (confidence ${t.confidence.toFixed(2)}), Arousal=${r}.`,o?"Crisis=true.":"Crisis=false.",a?"HumorAllowed=true (at most one short joke; keep optional).":"HumorAllowed=false (no jokes)."].join(" "),j=["Tone: empathetic, nonâ€‘judgmental, brief.","Structure: 1) brief acknowledgement/reflect; 2) one tiny option (e.g., 2â€‘minute breathing or grounding in /games) or a single next step; 3) one gentle followâ€‘up question.","Keep options optional; do not mention internal systems or models.","If Arousal=high & sentiment=negative: prioritize calming (box breathing, 5â€‘4â€‘3â€‘2â€‘1). If Arousal=low & sentiment=negative: suggest gentle activation (sip water, brief walk) or journaling. If Arousal=high & sentiment=positive: channel energy into a tiny challenge. If Arousal=low & sentiment=positive: savoring or rest."].join(" ");return[h,l,f,j].join(`
`)}async function Zt(s,n="chrlukas/stories-emotion-c2"){var t;try{const o=await fetch("/api/text-emotion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s,model:n})});if(!o.ok){const l=await o.text().catch(()=>"");throw new Error(`emotion HTTP ${o.status} ${l}`)}const a=await o.json(),r=Array.isArray(a==null?void 0:a.scores)?a.scores:[];return{label:typeof(a==null?void 0:a.label)=="string"?a.label:(t=r.sort((l,f)=>f.score-l.score)[0])==null?void 0:t.label,scores:r}}catch{return{label:void 0,scores:[]}}}function en(s){const n=(s||"").toLowerCase(),t=["joy","happy","happiness","trust","love","contentment"],o=["neutral","calm"],a=["anger","angry","fear","anxiety","panic","disgust"];return t.includes(n)?{valence:"positive",arousal:"medium"}:o.includes(n)?{valence:"neutral",arousal:"low"}:a.includes(n)?{valence:"negative",arousal:"high"}:{valence:"negative",arousal:"medium"}}function tn({onComplete:s}){const[n,t]=y.useState({consent:!1});y.useEffect(()=>{const a=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=a}},[]);const o=y.useMemo(()=>!!n.consent&&!!n.goal&&!!n.humor&&!!n.style,[n]);return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":!0,className:"card max-w-2xl w-full rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/80 dark:bg-slate-900/70 p-5 overflow-y-auto nice-scrollbar max-h-[88vh]",children:[e.jsx("div",{className:"flex items-start justify-between gap-3 mb-2",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Before we chat: a quick 1â€‘minute setup"}),e.jsx("p",{className:"text-xs text-slate-500",children:"These preferences live only in your browser and help me be more helpful."})]})}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Preferred name (optional)"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 bg-white/70 dark:bg-slate-900/50",placeholder:"e.g., Sam",value:n.name||"",onChange:a=>t({...n,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Pronouns (optional)"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 bg-white/70 dark:bg-slate-900/50",value:n.pronouns||"",onChange:a=>t({...n,pronouns:a.target.value||void 0}),children:[e.jsx("option",{value:"",children:"Selectâ€¦"}),e.jsx("option",{children:"she/her"}),e.jsx("option",{children:"he/him"}),e.jsx("option",{children:"they/them"}),e.jsx("option",{children:"prefer-not-to-say"}),e.jsx("option",{children:"other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"What brings you here today?"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[["reduce-stress","Reduce stress"],["improve-sleep","Improve sleep"],["stay-motivated","Stay motivated"],["talk-it-out","Talk things out"]].map(([a,r])=>e.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl border "+(n.goal===a?"bg-forest-100 dark:bg-forest-900/30":""),onClick:()=>t({...n,goal:a}),children:r},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"How stressed do you feel right now?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+((n.stress||3)===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,stress:a}),"aria-pressed":(n.stress||3)===a,"aria-label":`Stress ${a} of 5`,children:a},a))}),e.jsxs("div",{className:"text-xs mt-1",children:["Selected: ",n.stress||3," / 5"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"How was your sleep last night?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+((n.sleep||3)===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,sleep:a}),"aria-pressed":(n.sleep||3)===a,"aria-label":`Sleep ${a} of 5`,children:a},a))}),e.jsxs("div",{className:"text-xs mt-1",children:["Selected: ",n.sleep||3," / 5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Do you feel you have someone you can reach out to if needed?"}),e.jsx("div",{className:"flex gap-2",children:["yes","no","unsure"].map(a=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+(n.support===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,support:a}),children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Humor preference"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[["avoid","Avoid humor"],["sometimes","Sometimes okay"],["open","Open to light humor"]].map(([a,r])=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+(n.humor===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,humor:a}),children:r},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"What tone helps you most?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[["gentle","Gentle reassurance"],["practical","Practical tips"],["energizing","Cheering energy"]].map(([a,r])=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+(n.style===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,style:a}),children:r},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Would you like grounding/breathing suggestions?"}),e.jsx("div",{className:"flex gap-2",children:["yes","no"].map(a=>e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-xl border "+(n.grounding===a?"bg-slate-100 dark:bg-slate-800":""),onClick:()=>t({...n,grounding:a}),children:a},a))})]}),e.jsx("div",{className:"p-3 rounded-xl bg-slate-100/80 dark:bg-slate-800/60 text-xs",children:"Not a medical device. If you might be in danger or crisis, please contact local emergency services or a trusted person immediately."}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:!!n.consent,onChange:a=>t({...n,consent:a.target.checked})})," I understand and agree to continue"]})]}),e.jsx("div",{className:"mt-4 flex justify-end gap-2",children:e.jsx("button",{type:"button",className:"btn btn-primary disabled:opacity-60",disabled:!o,onClick:()=>s(n),children:"Start chat"})})]})})}const qe="onboarding.v1";function nn(){try{const s=localStorage.getItem(qe);return s?JSON.parse(s):null}catch{return null}}function sn(s){try{localStorage.setItem(qe,JSON.stringify(s))}catch{}}function an(s){switch(s){case"happy":return{valence:"positive",arousal:"medium"};case"sad":return{valence:"negative",arousal:"low"};case"angry":return{valence:"negative",arousal:"high"};case"fear":return{valence:"negative",arousal:"high"};case"disgust":return{valence:"negative",arousal:"medium"};case"surprise":return{valence:"neutral",arousal:"high"};case"neutral":default:return{valence:"neutral",arousal:"low"}}}function on(s){switch(s){case"happy":return"ðŸ™‚";case"sad":return"ðŸ™";case"angry":return"ðŸ˜ ";case"fear":return"ðŸ˜¨";case"disgust":return"ðŸ¤¢";case"surprise":return"ðŸ˜®";case"neutral":return"ðŸ˜";default:return"ðŸ˜¶"}}function rn({apiUrl:s="http://localhost:8000",intervalMs:n=4e3,onResult:t,onHealthChange:o,className:a,hideStatus:r}){const h=y.useRef(null),l=y.useRef(null),[f,j]=y.useState("pending"),[k,g]=y.useState({}),[c,w]=y.useState(!0),[m,b]=y.useState(null),[O,T]=y.useState(!1);y.useEffect(()=>{let N=null;async function x(){try{N=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240},audio:!1}),h.current&&(h.current.srcObject=N,await h.current.play(),T(!0)),j("granted")}catch{j("denied")}}return x(),()=>{N==null||N.getTracks().forEach(d=>d.stop()),T(!1)}},[]),y.useEffect(()=>{if(f!=="granted"||!c)return;let N=null;const x=async()=>{try{const d=h.current,v=l.current;if(!d||!v)return;const A=d.videoWidth||320,R=d.videoHeight||240;v.width=A,v.height=R;const P=v.getContext("2d");if(!P)return;P.drawImage(d,0,0,A,R);const W=v.toDataURL("image/jpeg",.6),J=new FormData;J.append("image_base64",W),J.append("enforce_detection","false");const K=await(await fetch(`${s}/analyze`,{method:"POST",body:J})).json(),ye=K.label,re=typeof K.confidence=="number"?K.confidence:void 0,ie=K.scores||{};g({label:ye,confidence:re}),t==null||t({label:ye,confidence:re,scores:ie})}catch{}finally{N=window.setTimeout(x,n)}};return N=window.setTimeout(x,500),()=>{N&&window.clearTimeout(N)}},[f,c,s,n,t]),y.useEffect(()=>{let N=!0;async function x(){try{const A=await(await fetch(`${s.replace(/\/$/,"")}/health`)).json();if(!N)return;const R=!!(A!=null&&A.deepface)&&!(A!=null&&A.import_error);b(R);try{o==null||o(R)}catch{}}catch{if(!N)return;b(!1);try{o==null||o(!1)}catch{}}}x();const d=window.setInterval(x,3e4);return()=>{N=!1,window.clearInterval(d)}},[s,o]);const C=on(k.label),L=k.label?`${k.label} ${k.confidence?Math.round(k.confidence*100)+"%":""}`:"no reading yet";return e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs "+(a||""),children:[e.jsx("video",{ref:h,className:"hidden",playsInline:!0,muted:!0}),e.jsx("canvas",{ref:l,className:"hidden"}),e.jsx("span",{title:L,"aria-live":"polite",children:C}),!r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-[10px] opacity-75",children:f==="pending"?"cam:pending":f==="denied"?"cam:denied":O?"cam:on":"cam:off"}),e.jsx("span",{className:`text-[10px] ${m===null?"opacity-60":m?"text-green-600":"text-rose-600"}`,children:m===null?"api:...":m?"api:ok":"api:down"}),e.jsx("button",{type:"button",className:"underline opacity-70 hover:opacity-100",onClick:()=>w(N=>!N),children:c?"tracking on":"tracking off"})]})]})}function ln({apiUrl:s,width:n=480,height:t=320,throttleMs:o=700}){var L,N;const a=s||((N=(L=import.meta)==null?void 0:L.env)==null?void 0:N.VITE_YOLO_API)||"http://localhost:8002/yolo/detect",r=M.useRef(null),h=M.useRef(null),[l,f]=M.useState(!1),[j,k]=M.useState(null),g=M.useRef(!1),c=M.useRef(null),w=M.useRef(!1),m=M.useRef(null),b=M.useCallback((x,d)=>{x.save(),x.lineWidth=2;for(const v of d){x.strokeStyle="rgba(34,197,94,0.9)",x.fillStyle="rgba(34,197,94,0.2)";const A=v.x2-v.x1,R=v.y2-v.y1;x.strokeRect(v.x1,v.y1,A,R);const P=`${v.label} ${(v.conf*100).toFixed(0)}%`,W=4,J=x.measureText(P).width,se=18;x.fillRect(v.x1,Math.max(0,v.y1-se),J+W*2,se),x.fillStyle="#0f172a",x.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",x.fillText(P,v.x1+W,Math.max(12,v.y1-4))}x.restore()},[]),O=M.useCallback(async()=>{if(g.current)return;const x=r.current,d=h.current;if(!(!x||!d)&&!(x.readyState<2)){g.current=!0;try{const v=d.getContext("2d");v.drawImage(x,0,0,d.width,d.height);const A=d.toDataURL("image/jpeg",.7),R=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:A})});if(!R.ok)throw new Error(`YOLO API ${R.status}`);const P=await R.json(),W=(P==null?void 0:P.detections)||[];v.drawImage(x,0,0,d.width,d.height),b(v,W),k(null)}catch(v){k((v==null?void 0:v.message)||"Detection failed")}finally{g.current=!1}}},[a,b]),T=M.useCallback(async()=>{try{const x=await navigator.mediaDevices.getUserMedia({video:{width:n,height:t},audio:!1});if(!r.current)return;r.current.srcObject=x,await r.current.play(),w.current=!0,f(!0);const d=()=>{if(!w.current)return;const A=r.current,R=h.current;A&&R&&R.getContext("2d").drawImage(A,0,0,R.width,R.height),m.current=window.requestAnimationFrame(d)};m.current=window.requestAnimationFrame(d);const v=async()=>{w.current&&(await O(),c.current=window.setTimeout(v,o))};c.current=window.setTimeout(v,o)}catch{k("Camera permission denied or unavailable"),w.current=!1,f(!1)}},[n,t,o,O]),C=M.useCallback(()=>{w.current=!1,f(!1),c.current&&(window.clearTimeout(c.current),c.current=null),m.current&&(window.cancelAnimationFrame(m.current),m.current=null);const x=r.current;x&&x.srcObject&&(x.srcObject.getTracks().forEach(v=>v.stop()),x.srcObject=null)},[]);return M.useEffect(()=>()=>C(),[C]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx("button",{className:"btn px-3 py-1.5",onClick:C,children:"Stop YOLO"}):e.jsx("button",{className:"btn btn-outline px-3 py-1.5",onClick:T,children:"Start YOLO"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Endpoint: ",a]}),l&&!j&&e.jsx("span",{className:"text-xs text-emerald-600",children:"Detectingâ€¦"})]}),j&&e.jsx("div",{className:"text-xs text-rose-600",children:j}),e.jsxs("div",{className:"relative inline-block rounded-xl overflow-hidden border border-slate-200/60 dark:border-slate-800/60 bg-black",children:[e.jsx("video",{ref:r,width:n,height:t,className:"hidden"}),e.jsx("canvas",{ref:h,width:n,height:t})]})]})}function cn({onTranscript:s,autoSend:n=!0,lang:t="en-US",onStart:o,onStop:a}){const[r,h]=y.useState(!1),[l,f]=y.useState(!0),j=y.useRef(null);y.useEffect(()=>{const c=window,w=c.SpeechRecognition||c.webkitSpeechRecognition;if(!w){f(!1);return}const m=new w;return m.lang=t,m.interimResults=!1,m.maxAlternatives=1,m.onresult=b=>{const O=b.results[0][0].transcript;s(O)},m.onend=()=>{h(!1);try{a==null||a()}catch{}},m.onerror=b=>{console.warn("STT error",b),h(!1);try{a==null||a()}catch{}},j.current=m,()=>{try{m.stop()}catch{}}},[s,n,t]);function k(){const c=j.current;if(c){try{c.start(),h(!0)}catch(w){console.warn(w),h(!1)}try{o==null||o()}catch{}}}function g(){const c=j.current;if(c){try{c.stop()}catch{}h(!1)}}return e.jsxs("div",{className:"inline-flex items-center gap-2",children:[!l&&e.jsx("span",{className:"text-xs opacity-60",children:"Speech not supported"}),e.jsx("button",{onClick:()=>r?g():k(),className:`px-2 py-1 rounded-md border text-xs ${r?"bg-rose-100 dark:bg-rose-900":"bg-white/70 dark:bg-slate-900/50"}`,"aria-pressed":r,children:r?"Listeningâ€¦":"ðŸŽ¤ Talk"})]})}function Pe(s,n){if(typeof s!="string")return"";let t=s;return t=t.replace(/\bAs an AI(?:[^\n\.]*)?/gi,"").replace(/\bAs a language model(?:[^\n\.]*)?/gi,"").replace(/\bI'm an AI(?:[^\n\.]*)?/gi,""),t=t.replace(/\bI think\b/gi,"I feel").replace(/\bIt seems\b/gi,"It sounds like").replace(/\bBased on my training\b/gi,"From experience"),/[.!?]\s*$/.test(t.trim())||(t=t.trim()+"."),t.trim()}const ee={},We=(ee==null?void 0:ee.VITE_GEMINI_REPORT_MODEL)||(ee==null?void 0:ee.VITE_GEMINI_MODEL)||"gemini-2.5-flash",dn="AIzaSyD7Hk4Xp9zIN9dbELnXh55rk_QgNSwdYA0",un={type:"OBJECT",properties:{natureSummary:{type:"STRING",description:"A concise, objective summary of the user's underlying nature, disposition, or personality traits revealed in the conversation."},stressLevel:{type:"STRING",description:"An assessment of the user's current stress level, categorized as 'Low', 'Moderate', or 'High'."},keyProblems:{type:"ARRAY",description:"A bulleted list of the main problems, concerns, or recurring themes identified from the dialogue.",items:{type:"STRING"}},thinkingPatterns:{type:"STRING",description:"An analysis of the user's thinking style (e.g., rational, emotive, cyclical, detail-focused, or future-oriented)."},generalReflection:{type:"STRING",description:"A short, actionable, general self-reflection prompt based on the overall psychological findings."},wellnessRecommendations:{type:"STRING",description:"Personalized wellness recommendations based on the detected stress level and problems. Recommend tailored activities such as mindfulness techniques, specific types of physical activities (e.g., walking, stretching), or motivational content/strategies in a single, encouraging paragraph."}},required:["natureSummary","stressLevel","keyProblems","thinkingPatterns","generalReflection","wellnessRecommendations"]};function hn(s){try{return s.split(/\r?\n/).filter(o=>/^\s*(user)\s*:/i.test(o)).map(o=>o.replace(/^\s*user\s*:\s*/i,"").trim()).join(`
`)}catch{return s}}function De(s){const n=s.toLowerCase(),t=(n.match(/stress|stressed|overwhelm|overwhelmed|anxious|anxiety|panic|can\'t sleep|insomnia|deadline|pressure|burnout|tired|exhausted/g)||[]).length,o=(n.match(/sleep|insomnia|awake|can\'t sleep|night/g)||[]).length,a=(n.match(/control|can\'t control|helpless|boundar/g)||[]).length,r=(n.match(/guilt|guilty/g)||[]).length,h=t>=8?"High":t>=3?"Moderate":"Low",l=[];return a&&l.push("Perceived lack of control and boundary difficulties"),o&&l.push("Sleep disruption and unhelpful nighttime rumination"),r&&l.push("Selfâ€‘criticism or guilt after setting limits"),l.length||l.push("General stress and emotional load"),{natureSummary:"Thoughtful and conscientious; tends to internalize pressure and take on responsibility.",stressLevel:h,keyProblems:l,thinkingPatterns:"Futureâ€‘focused worry with occasional allâ€‘orâ€‘nothing thinking; attentive to obligations.",generalReflection:"What is one small boundary or 10â€‘minute pause you could try this week, and how might you support yourself when guilt appears?",wellnessRecommendations:"Try a short evening windâ€‘down (screens off for 30â€“60 minutes), a 10â€‘minute daylight walk most days, and jot down the top 3 priorities for tomorrow to reduce bedtime rumination."}}async function mn(s){var h,l,f,j,k;const n=hn(s),t={parts:[{text:"You are a specialized psychological analysis engine. Your task is to objectively analyze the provided conversation text and output a structured JSON report based on the defined schema. Use professional, neutral language. Base all assessments strictly on the text provided. Focus the analysis only on the 'User' parts of the transcript."}]},a={contents:[{parts:[{text:`Analyze the following conversation transcript. Generate a structured JSON report based on the required schema. TRANSCRIPT:
---
${s}`}]}],systemInstruction:t,generationConfig:{responseMimeType:"application/json",responseSchema:un},model:We},r=`https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(We)}:generateContent?key=${encodeURIComponent(dn)}`;try{const g=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!g.ok){const m=await g.text().catch(()=>"");throw new Error(`HTTP ${g.status} ${m}`)}const c=await g.json(),w=(k=(j=(f=(l=(h=c==null?void 0:c.candidates)==null?void 0:h[0])==null?void 0:l.content)==null?void 0:f.parts)==null?void 0:j[0])==null?void 0:k.text;if(typeof w=="string"&&w.trim())try{return{report:JSON.parse(w)}}catch{return{report:De(n),error:"Model did not return valid JSON; used heuristic."}}return{report:De(n),error:"Empty model response; used heuristic."}}catch(g){return{report:De(n),error:String((g==null?void 0:g.message)||g)}}}const He={},fn=(He==null?void 0:He.VITE_PROGRESS_API)||"http://localhost:5001";function pn(s,n="ws://localhost:4000"){const t=y.useRef(null);y.useEffect(()=>{if(s)try{const l=new WebSocket(n);return t.current=l,l.onopen=()=>l.send(JSON.stringify({type:"subscribe",userId:s})),l.onclose=()=>console.log("ws closed"),()=>l.close()}catch(l){console.warn("ws not opened",l)}},[s,n]);async function o(l){try{await fetch(`${fn}/api/progress/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s,point:l})})}catch(f){console.warn("postPoint failed",f)}}function a(l,f="client"){const j={t:Date.now(),value:l,source:f};try{t.current&&t.current.readyState===WebSocket.OPEN&&t.current.send(JSON.stringify({type:"stressPoint",userId:s,point:j}))}catch{}o(j)}function r(l){for(const f of l){o(f);try{t.current&&t.current.readyState===WebSocket.OPEN&&t.current.send(JSON.stringify({type:"stressPoint",userId:s,point:f}))}catch{}}}function h(l){l!=null&&l.points&&Array.isArray(l.points)&&r(l.points)}return{emitStress:a,emitBulk:r,emitFinalReport:h}}const V={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALLOW_DEMO_AUTH:"false",VITE_ASSISTANT_URL:"https://pvassist.onrender.com/",VITE_FIREBASE_API_KEY:"AIzaSyCH9-4pASKxCUwW7Lr7k0F7hJfppWO7rXU",VITE_FIREBASE_APP_ID:"1:772277162051:web:bbca7127ecbc3d7c5584f6",VITE_FIREBASE_AUTH_DOMAIN:"mindmate-5f71d.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-54E6LBGTBG",VITE_FIREBASE_MESSAGING_SENDER_ID:"772277162051",VITE_FIREBASE_PROJECT_ID:"mindmate-5f71d",VITE_FIREBASE_STORAGE_BUCKET:"mindmate-5f71d.firebasestorage.app",VITE_GEMINI_API_KEY:"AIzaSyD7Hk4Xp9zIN9dbELnXh55rk_QgNSwdYA0",VITE_HF_SPACE_URL:"https://unknownhackerr-mental-health-beta16.hf.space",VITE_YOLO_API:"http://localhost:8002/yolo/detect"};function gn(s){const n=s.split(`
`);return e.jsx(e.Fragment,{children:n.map((t,o)=>{const a=t.split(/(https?:\/\/[^\s]+)/i);return e.jsxs(M.Fragment,{children:[a.map((r,h)=>/^https?:\/\//i.test(r)?e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"underline",children:r},`l-${o}-${h}`):e.jsx(M.Fragment,{children:r},`t-${o}-${h}`)),o<n.length-1?e.jsx("br",{}):null]},`line-${o}`)})})}const yn=["I feel overwhelmed by studies","Can we do a 3-minute breathing?","I slept well and felt calmer today","Teach me grounding 5-4-3-2-1"];function In(){var ze;const s=(V==null?void 0:V.VITE_ENABLE_YOLO)==="true",n=(V==null?void 0:V.VITE_ENABLE_TALK)==="true",t=lt(),o=nn(),[a,r]=y.useState(""),[h,l]=y.useState(!1),[f,j]=y.useState(!1),k="ðŸ’¬ MindMate",[g,c]=y.useState([{from:"bot",text:"ðŸ± Whiskers the cat: Meow! Hi there.",ts:Date.now()-1e3},{from:"bot",text:`${k}: Hi â€” we're glad you're here. When you're ready, say hello or tell me how you're feeling.`,ts:Date.now()}]),[w,m]=y.useState(null),[b,O]=y.useState(o),{user:T}=ct(),C=y.useRef(null),L=y.useRef(null),[N,x]=y.useState(null),[d,v]=y.useState(null),[A,R]=y.useState([]),[P,W]=y.useState(null),[J,se]=y.useState(!1),[K,ye]=y.useState(!0),[re,ie]=y.useState(!1),[Ye,Xe]=y.useState(null),[_e,Qe]=y.useState(!1),{emitStress:be}=pn(T==null?void 0:T.email);y.useEffect(()=>{var i;(i=C.current)==null||i.scrollIntoView({behavior:"smooth",block:"end"})},[g,h]),y.useEffect(()=>{var i;(i=L.current)==null||i.focus()},[]),y.useEffect(()=>{try{if(!A.length||!(d!=null&&d.label)||Ye===!1)return;const i=new Set(["sad","angry","fear","disgust"]),u=A.slice(-4).filter($=>i.has($)).length,E=Date.now();if(u>=2&&d.confidence&&d.confidence>=.55&&(!P||E-P>1e3*60*3)){const $=k,S="I noticed you might be looking a bit distressed from the camera â€” I care about how you're doing. Would you like a short grounding exercise or to tell me what's been hardest?",U="You're not alone. If you'd like, we can try a 1-minute breathing together or open /games for a guided grounding.";c(X=>[...X,{from:"bot",text:`${$}: ${S}

${U}`,ts:Date.now()}]),W(E)}}catch{}},[A,d,P,k,Ye]);function Ze(i,p,u,E,$){let S=50;return i==="negative"&&(S+=20),i==="positive"&&(S-=10),S=S*(1+((typeof p=="number"?p:.6)-.5)*.4),u==="high"&&(S+=15),u==="low"&&(S-=8),E&&(E.valence==="negative"&&(S+=12),E.arousal==="high"&&(S+=10),E.valence==="positive"&&(S-=8)),$&&(S=S*(1+Math.min(.25,($-.5)*.5))),S=Math.max(0,Math.min(100,Math.round(S))),S}async function le(i){var S,U,X,_,Ve;if(!b)return;const p=typeof i=="string"?i:a;if(!p.trim())return;const u=p.trim(),E=Date.now(),$={from:"user",text:u,ts:E};c(Y=>[...Y,$]),r(""),Te(u)&&m(u),l(!0),x({kind:"typing",ts:Date.now()});try{const Y=k,we=/(suicid|kill myself|end my life|want to die|i want to die|i will kill myself|i am going to kill myself|self[- ]?harm|cut myself|jump off|can'?t go on|ending it|end it all|life isn'?t worth)/i,ve=Te(u)||we.test(u);if(ve){const I=[`${Y}: I'm taking what you said very seriously. It sounds like you're in a lot of pain, and I'm genuinely worried about you.`,"Your safety is the most important thing. You are not alone, and there are people who can help you right now.","Please reach out to one of these 24/7, free resources in India (call or text):","â€¢ Emergency â€” Call 112","â€¢ KIRAN Mental Health Helpline â€” 1800-599-0019 (24Ã—7, toll-free)","â€¢ AASRA â€” +91-22-27546669 (24Ã—7)","â€¢ Vandrevala Foundation â€” +91-9999-666-555","If any number doesnâ€™t connect, please try again or search â€œIndia suicide helplineâ€ for the latest options. Iâ€™m still here with you."].join(`

`);c(D=>[...D,{from:"bot",text:I,ts:Date.now()}]),m(u);return}const ke=[...g,$],je=ke.slice(-6).map(I=>({role:I.from==="user"?"user":"bot",text:I.text})),at=Qt(u,je),Q=!0,Ne=(V==null?void 0:V.VITE_LOCAL_LLM)==="true"||!!(V!=null&&V.VITE_LOCAL_LLM_PATH);if(/\b(what'?s|whats) my expression\b|\bmy expression\b/i.test(u)){if(d!=null&&d.label){const I=d.confidence?` (${Math.round(d.confidence*100)}%)`:"";c(D=>[...D,{from:"bot",text:`${Y}: From the webcam, Iâ€™m seeing "${d.label}"${I}. You can turn tracking off anytime from the header.`,ts:Date.now()}])}else c(I=>[...I,{from:"bot",text:`${Y}: I donâ€™t have a recent webcam reading. If you allow camera access (top-right) and keep the window in view, I can estimate expressions on-device.`,ts:Date.now()}]);return}if(!Ue(u)){const I=[`${Y}: Iâ€™m here to support mental wellbeingâ€”feelings, stress, sleep, motivation, and coping.`,"I canâ€™t help with that topic, but if youâ€™d like, tell me how youâ€™re feeling right now or whatâ€™s been hardest today."].join(`

`),D=g.slice().reverse().find(H=>H.from==="bot");if(D&&((S=D.text)==null?void 0:S.trim())===I.trim()){c(H=>[...H,{from:"bot",text:`${Y}: Okay â€” I hear you. Iâ€™m here if you want to talk later.`,ts:Date.now()}]);return}if(Q||Ne)try{const H=Me({botLabel:Y,sentiment:{label:"neutral",confidence:.95},crisis:!1,humorAllowed:!1,arousal:"low"}),F=`Rephrase the following concise, firm but friendly boundary message so it sounds warm and human, without adding new instructions or resources. Keep it short:

${I}`,G=Q?await Re(F,[],{system:H}):await Ce(F,[],{system:H});c(Ie=>[...Ie,{from:"bot",text:Pe(G||I),ts:Date.now()}]);return}catch{}c(H=>[...H,{from:"bot",text:I,ts:Date.now()}]);return}const z=await Je(u),q=typeof z.confidence=="number"?z.confidence:.6,ot=/(fuck|bitch|asshole|bastard|stupid|idiot|madarchod|mc|bc|screw you|shut up)/i.test(u),B=await Zt(u),ce=en(B.label).arousal,de=d!=null&&d.label?an(d.label):null,rt=de?de.valence==="negative"&&de.arousal==="high":!1,ae=!ve&&!ot&&(z.label!=="negative"||q<.65&&ce!=="high")&&!rt,it=z.label==="positive"?"energizing":z.label==="negative"&&q>=.75?"gentle":"steady",ue=oe(it),he=ae?await ge({category:z.label==="positive"?"Programming":"Misc"}):null,me=!ve&&z.label==="positive"?await Ke("You got this"):null;try{const I=Ze(z.label,q,ce,de,d==null?void 0:d.confidence);be(I)}catch(I){console.warn("emitStress failed",I)}if(at==="hf"){const I=await Ge(u,je);if(Q||Ne){const D=Me({botLabel:Y,sentiment:{label:z.label,confidence:q},crisis:!1,humorAllowed:ae,arousal:ce}),H=[`Context meta: sentiment=${z.label} confidence=${q.toFixed(2)} humorAllowed=${ae}`,B.label?`Emotion (HF): ${B.label}${((X=(U=B.scores)==null?void 0:U[0])==null?void 0:X.score)!=null?` (${Math.round(B.scores[0].score*100)}%)`:""}`:"",b?`User prefs: goal=${b.goal||"n/a"} style=${b.style||"n/a"} humor=${b.humor||"n/a"} grounding=${b.grounding||"n/a"}`:"",d!=null&&d.label?`Observed emotion (webcam): ${d.label}${d.confidence?` (${Math.round(d.confidence*100)}%)`:""}`:"",ue?`Motivation: ${ue}`:"",he?`Joke: ${he}`:"",me?`Banner:
${me}`:""].filter(Boolean).join(`

`);try{const F=`User said: "${u}"

Plan suggestions for you to adapt:
${I.text}

${H}

Respond directly to the user in a warm tone.`,G=ke.slice(-4).map(fe=>({role:fe.from==="user"?"user":"model",text:fe.text})),Ie=Q?await Re(F,G,{system:D}):await Ce(F,G,{system:D});c(fe=>[...fe,{from:"bot",text:Pe(Ie),ts:Date.now()}])}catch{c(F=>[...F,{from:"bot",text:I.text,ts:Date.now()}])}}}else if(Q||Ne)try{const I=Me({botLabel:Y,sentiment:{label:z.label,confidence:q},crisis:!1,humorAllowed:ae,arousal:ce}),D=[`Context meta: sentiment=${z.label} confidence=${q.toFixed(2)} humorAllowed=${ae}`,B.label?`Emotion (HF): ${B.label}${((Ve=(_=B.scores)==null?void 0:_[0])==null?void 0:Ve.score)!=null?` (${Math.round(B.scores[0].score*100)}%)`:""}`:"",b?`User prefs: goal=${b.goal||"n/a"} style=${b.style||"n/a"} humor=${b.humor||"n/a"} grounding=${b.grounding||"n/a"}`:"",d!=null&&d.label?`Observed emotion (webcam): ${d.label}${d.confidence?` (${Math.round(d.confidence*100)}%)`:""}`:"",ue?`Motivation: ${ue}`:"",he?`Joke: ${he}`:"",me?`Banner:
${me}`:"","You may suggest opening /games for a 2-minute breathing or grounding exercise when appropriate."].filter(Boolean).join(`

`),H=ke.slice(-6).map(G=>({role:G.from==="user"?"user":"model",text:G.text})),F=Q?await Re(`${D}

User: ${u}`,H,{system:I}):await Ce(`${D}

User: ${u}`,H,{system:I});c(G=>[...G,{from:"bot",text:Pe(F),ts:Date.now()}])}catch{const I=await Ge(u,je);c(D=>[...D,{from:"bot",text:I.text,ts:Date.now()}])}/suicid|kill|end it|hopeless|worthless|i'm done|im done|done with life/i.test(u)&&m(u)}catch{const Y=k;c(we=>[...we,{from:"bot",text:`${Y}: Iâ€™m here. Letâ€™s try a 3-minute breathing exercise together? If youâ€™d like, open Games for a calming start.`,ts:Date.now()}])}finally{l(!1),x(null)}}function et(i){const p=i.trim();if(p){if(!Ue(p)){const E=[`${k}: Iâ€™m here to support mental wellbeingâ€”feelings, stress, sleep, motivation, and coping.`,"I canâ€™t help with that topic via voice, but if youâ€™d like, tell me how youâ€™re feeling right now."].join(`

`);c($=>[...$,{from:"bot",text:E,ts:Date.now()}]);return}if(Te(p)){c(u=>[...u,{from:"user",text:p,ts:Date.now()}]),m(p);return}K?le(p):r(p)}}y.useEffect(()=>{try{if(!J||!re)return;const i=g[g.length-1];if(!i||i.from!=="bot"||w)return;const p=i.text||"";if(/\d{3,}/.test(p)&&/helpline|call|emergency|phone|call\s+112/i.test(p))return;const u=window.speechSynthesis;if(!u)return;u.cancel();const E=new SpeechSynthesisUtterance(p.length>800?p.slice(0,600)+"... I have more in the chat.":p);E.lang="en-US",E.rate=1,E.pitch=1,u.speak(E)}catch{}return()=>{try{const i=window.speechSynthesis;i==null||i.cancel()}catch{}}},[g]);function tt(i){try{if(!i||w||/\d{3,}/.test(i)&&/helpline|call|emergency|phone|call\s+112/i.test(i))return;const p=window.speechSynthesis;if(!p)return;p.cancel();const u=new SpeechSynthesisUtterance(i.length>800?i.slice(0,600)+"... I have more in the chat.":i);u.lang="en-US",u.rate=1,u.pitch=1,p.speak(u)}catch{}}const nt="ðŸ’¬",st="MindMate";async function xe(){var i;if(!f){j(!0);try{const p=g.map(U=>`${U.from==="user"?"User":"AI"}: ${U.text}`).join(`
`),{report:u}=await mn(p),E=((i=g[0])==null?void 0:i.ts)||Date.now(),$=Date.now(),S={id:mt(),bot:"mindmate",title:ht(g),startedAt:E,endedAt:$,messages:g,report:u||void 0};ft(S);try{if(u!=null&&u.points&&Array.isArray(u.points)&&u.points.length)for(const U of u.points)be(U.value);else u!=null&&u.stressLevel&&be((X=>{const _=(X||"").toLowerCase();return _.includes("high")?85:_.includes("moderate")?60:_.includes("low")?25:50})(u==null?void 0:u.stressLevel))}catch(U){console.warn("emit final report points failed",U)}t("/reports")}catch{t("/reports")}finally{j(!1)}}}return e.jsxs("div",{className:"relative max-w-3xl mx-auto",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(60rem_40rem_at_120%_-10%,theme(colors.indigo.300/15),transparent),radial-gradient(60rem_40rem_at_-10%_0%,theme(colors.cyan.300/12),transparent)]"}),e.jsxs("section",{className:"card rounded-2xl border border-slate-200/60 dark:border-slate-800/60 bg-white/70 dark:bg-slate-900/60 backdrop-blur p-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 md:px-6 py-3 border-b border-slate-200/60 dark:border-slate-800/60 bg-white/60 dark:bg-slate-900/60",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-tr from-indigo-500 to-cyan-500 text-white text-lg shadow",children:nt}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold leading-tight",children:st}),s&&_e&&e.jsx("div",{className:"px-4 md:px-6 py-3 border-b border-slate-200/60 dark:border-slate-800/60 bg-white/50 dark:bg-slate-900/50",children:e.jsx(ln,{})}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Empathetic companion â€¢ responses may be AI-generated"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[e.jsx(rn,{hideStatus:!0,onResult:i=>{v({label:i.label,confidence:i.confidence}),i.label&&R(p=>[...p,i.label].slice(-8))},onHealthChange:i=>Xe(i)}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsxs("button",{type:"button",onClick:()=>Qe(i=>!i),className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl border hover:bg-slate-100 dark:hover:bg-slate-800 transition",title:"Toggle YOLO object detection",children:[e.jsx(wt,{size:16}),e.jsx("span",{children:"YOLO"})]}),n&&e.jsx(cn,{onTranscript:et,autoSend:K,lang:navigator.language||"en-US",onStart:()=>{ie(!0),se(!0)},onStop:()=>ie(!1)}),e.jsxs("a",{href:dt,target:"_blank",rel:"noopener noreferrer",title:"Open Voice Assistant",className:"hidden md:inline-flex items-center gap-2 px-3 py-1.5 rounded-xl border hover:bg-slate-100 dark:hover:bg-slate-800 transition",children:[e.jsx(bt,{size:16}),e.jsx("span",{children:"Voice Assistant"})]}),e.jsx("span",{title:"Text-to-speech status",children:J?"ðŸ”Š":"ðŸ”ˆ"})]}),A.length>0&&e.jsx("div",{className:"text-xs opacity-75",title:A.join(", "),children:A.map((i,p)=>e.jsx("span",{className:"ml-0.5",children:{happy:"ðŸ™‚",sad:"ðŸ™",angry:"ðŸ˜ ",fear:"ðŸ˜¨",disgust:"ðŸ¤¢",surprise:"ðŸ˜®",neutral:"ðŸ˜"}[i]},p))}),e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border border-slate-200/60 dark:border-slate-800/60 bg-white/70 dark:bg-slate-950/40 px-3 py-1.5 text-xs text-slate-600 dark:text-slate-300",children:[e.jsx(pt,{className:"h-3.5 w-3.5"})," Be kind to yourself"]}),e.jsx("button",{onClick:xe,disabled:f,"aria-label":"Close chat",title:"Close chat and generate report",className:`ml-2 p-1.5 rounded-md border hover:bg-slate-100 dark:hover:bg-slate-800 ${f?"opacity-60 cursor-not-allowed":""}`,children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex md:hidden items-center gap-2",children:e.jsx("button",{onClick:xe,disabled:f,"aria-label":"Close chat",title:"Close chat and generate report",className:`p-2 rounded-md border hover:bg-slate-100 dark:hover:bg-slate-800 ${f?"opacity-60 cursor-not-allowed":""}`,children:e.jsx(Se,{className:"h-5 w-5"})})})]}),e.jsx("div",{className:"md:hidden px-4 py-2 border-b border-slate-200/60 dark:border-slate-800/60 flex justify-end bg-white/60 dark:bg-slate-900/60",children:e.jsx("button",{onClick:xe,disabled:f,className:`px-3 py-1.5 rounded-xl border ${f?"opacity-60 cursor-not-allowed":""}`,title:"Close chat and generate report",children:f?"Generatingâ€¦":"Close Chat"})}),e.jsxs("div",{className:"px-4 md:px-6 py-4 h-[62vh] overflow-y-auto space-y-3",children:[e.jsx(Ae,{initial:!1,children:g.map((i,p)=>e.jsx(pe.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.2},className:(i.from==="user"?"ml-auto":"")+" max-w-[82%]",children:e.jsx("div",{className:"px-3 py-2 rounded-2xl shadow-sm "+(i.from==="user"?"bg-forest-100 dark:bg-forest-900/30":"bg-slate-100 dark:bg-slate-800/80"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap flex-1",children:gn(i.text)}),i.from==="bot"&&e.jsx("button",{"aria-label":"Play message",title:"Play message",onClick:()=>tt(i.text),className:"ml-2 p-1 rounded hover:bg-slate-200 dark:hover:bg-slate-700",children:e.jsx(kt,{className:"h-4 w-4"})})]})})},p))}),e.jsx(Ae,{children:h&&e.jsx(pe.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},className:"max-w-[82%]",children:e.jsxs("div",{className:"px-3 py-2 rounded-2xl bg-slate-100 dark:bg-slate-800/80 inline-flex items-center gap-2",children:[e.jsx(ut,{className:"h-4 w-4 text-slate-500"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-slate-400 animate-bounce [animation-delay:0ms]"}),e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-slate-400 animate-bounce [animation-delay:120ms]"}),e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-slate-400 animate-bounce [animation-delay:240ms]"})]})]})})}),e.jsx("div",{ref:C})]}),e.jsxs("div",{className:"px-4 md:px-6 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"sr-only",htmlFor:"chat-input",children:"Type how you feel"}),e.jsx("input",{id:"chat-input",ref:L,className:"flex-1 border rounded-xl px-3 py-2 bg-white/70 dark:bg-slate-900/50",placeholder:b?"Type how you feel...":"Please complete quick setup to start chatting",value:a,onChange:i=>r(i.target.value),onKeyDown:i=>{i.key==="Enter"&&le()},"aria-label":"Type how you feel",disabled:!b}),e.jsxs("button",{onClick:()=>le(),className:"btn btn-primary inline-flex items-center gap-2",disabled:!a.trim()||!b,"aria-disabled":!a.trim()||!b,children:[e.jsx(vt,{className:"h-4 w-4"})," Send"]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:yn.map(i=>e.jsx("button",{onClick:()=>le(i),className:"text-xs rounded-full border border-slate-200/60 dark:border-slate-800/60 px-3 py-1.5 hover:bg-slate-50 dark:hover:bg-slate-800",children:i},i))})]})]}),e.jsxs(Ae,{children:[!b&&e.jsx(tn,{onComplete:i=>{sn(i),O(i),c(p=>{if(p.length>=2){const u=p[0],E=p[1],$={from:u.from,ts:u.ts,text:`ðŸ± Whiskers the cat: Meow! Hi${i.name?" "+i.name:""}.`},S={from:E.from,ts:E.ts,text:`${k}: Hi${i.name?" "+i.name:""} â€” we're glad you're here. When you're ready, say hello or tell me how you're feeling.`};return[$,S,...p.slice(2)]}return p})}}),w&&e.jsx(pe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4","aria-live":"assertive",children:e.jsxs(pe.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.2},role:"dialog","aria-modal":"true",className:"card max-w-md w-full rounded-2xl border border-amber-300/40 bg-amber-50/70 text-amber-900 dark:border-amber-400/20 dark:bg-amber-950/30 dark:text-amber-200 p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(gt,{className:"h-5 w-5"})," You matter. Letâ€™s get support."]}),e.jsx("button",{className:"rounded-md p-1 hover:bg-black/5 dark:hover:bg-white/5",onClick:()=>m(null),"aria-label":"Close",children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-amber-900/90 dark:text-amber-200/90 mt-1",children:"Your message suggests you might be in distress. Consider reaching out to someone you trust or local emergency services immediately."}),(ze=T==null?void 0:T.lovedOnes)!=null&&ze.length?e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("p",{className:"text-sm",children:"Send a WhatsApp message to:"}),T.lovedOnes.map((i,p)=>e.jsxs("a",{className:"block px-3 py-2 rounded-xl border hover:bg-amber-100/40 dark:hover:bg-amber-900/20",target:"_blank",rel:"noreferrer noopener",href:Ot(i.whatsapp??"",`This is ${T.name}. I need support right now. Can we talk?`),children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(yt,{className:"h-4 w-4"})," ",i.name]})," ",e.jsxs("span",{className:"text-xs opacity-70",children:["(",i.whatsapp,")"]})]},p))]}):e.jsx("p",{className:"text-sm text-amber-900/90 dark:text-amber-200/90 mt-3",children:"Add loved-one contacts in your Dashboard to enable quick alerts."}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsxs("a",{className:"px-3 py-2 rounded-xl border btn-outline inline-flex items-center gap-2",href:"tel:112",children:[e.jsx(xt,{className:"h-4 w-4"})," Call emergency (112)"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>m(null),children:"Iâ€™m safe"})]}),e.jsx("p",{className:"text-xs opacity-70 mt-3",children:"This demo does not automatically notify anyone. Automated messaging requires consent and WhatsApp Business API."})]})})]}),e.jsx("div",{className:"sr-only",children:"Chat supports quick suggestions, typing indicator, and crisis resources."})]})}export{In as default};
