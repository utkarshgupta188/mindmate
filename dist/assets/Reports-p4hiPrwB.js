import{u as A,r as v,j as e}from"./index-C4Srh_oV.js";import{l as E,d as I}from"./chatStore-BauJIQZO.js";function W(){var k;const{user:b}=A(),[p,P]=v.useState(()=>E()),[u,w]=v.useState(((k=p[0])==null?void 0:k.id)||null),s=v.useMemo(()=>p.find(t=>t.id===u)||null,[p,u]);function R(t){var a;I(t);const l=E();P(l),u===t&&w(((a=l[0])==null?void 0:a.id)||null)}async function N(){window.html2pdf||await new Promise((l,a)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js",n.defer=!0,n.onload=()=>l(),n.onerror=()=>a(new Error("Failed to load html2pdf")),document.head.appendChild(n)})}function S(t,l){const a=document.createElement("div");a.style.width="800px",a.style.margin="0 auto",a.style.fontFamily="Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial",a.style.color="#1f2937";const n=document.createElement("div");n.style.background="linear-gradient(90deg,#4f46e5,#06b6d4)",n.style.color="#fff",n.style.padding="16px 20px",n.style.borderRadius="12px 12px 0 0";const o=document.createElement("h1");o.style.margin="0",o.style.fontSize="20px",o.style.fontWeight="700",o.textContent="Conversation Well-being Analysis";const c=document.createElement("p");c.style.margin="6px 0 0 0",c.style.fontSize="12px",c.style.opacity="0.9",c.textContent=`Chat: ${l.title} â€¢ ${new Date(l.startedAt).toLocaleString()} â€” Generated ${new Date().toLocaleString()}`,n.appendChild(o),n.appendChild(c),a.appendChild(n);const i=(x,d)=>{const h=document.createElement("div");h.style.padding="14px 18px",h.style.borderBottom="1px solid #eef2ff";const g=document.createElement("div");g.style.fontWeight="700",g.style.marginBottom="6px",g.textContent=x,h.appendChild(g),h.appendChild(d),a.appendChild(h)},m=x=>{const d=document.createElement("div");return d.textContent=x||"â€”",d};i("Nature Summary",m(t.natureSummary));const f=document.createElement("div"),r=document.createElement("span"),C=(t.stressLevel||"").toLowerCase();r.textContent=t.stressLevel||"â€”",r.style.display="inline-block",r.style.padding="6px 10px",r.style.borderRadius="999px",r.style.fontWeight="600",C.includes("high")?r.style.background="#fee2e2":C.includes("moderate")?r.style.background="#fef3c7":r.style.background="#dcfce7",f.appendChild(r),i("Stress Level",f),i("Thinking Patterns",m(t.thinkingPatterns));const y=document.createElement("ul");y.style.paddingLeft="18px",(Array.isArray(t.keyProblems)?t.keyProblems:["â€”"]).forEach(x=>{const d=document.createElement("li");d.textContent=x,y.appendChild(d)}),i("Identified Themes/Concerns",y),i("General Reflection",m(t.generalReflection));const T=m(t.wellnessRecommendations);i("Personalized Wellness Recommendation",T);const j=document.createElement("div");return j.style.padding="12px 18px",j.innerHTML='<small style="color:#6b7280">Disclaimer: This report is AI-generated and is not a substitute for professional advice.</small>',a.appendChild(j),a}async function D(){if(!s||!s.report)return;await N();const t=S(s.report,s),l=window,a={margin:[12,12,12,12],filename:`chat_report_${new Date().toISOString().replace(/[:.]/g,"-")}.pdf`,image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"pt",format:"a4",orientation:"portrait"}};try{l.html2pdf().set(a).from(t).save()}catch{alert("Failed to generate PDF. Please try again.")}}async function L(){if(!s||!s.report)return;const t=prompt("Send to email address:",(b==null?void 0:b.email)||"");if(!t)return;await N();const l=S(s.report,s),a=window,n={margin:[12,12,12,12],image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"pt",format:"a4",orientation:"portrait"}},i=(await a.html2pdf().set(n).from(l).outputPdf("datauristring")).replace(/^data:application\/pdf;filename=generated\.pdf;base64,/,""),m=`chat_report_${new Date().toISOString().replace(/[:.]/g,"-")}.pdf`;try{if(!(await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:t,subject:"Your Conversation Report",filename:m,pdfBase64:i})})).ok)throw new Error("Email send failed");alert("Email sent!")}catch{alert("Failed to send email. Please check server email settings.")}}return e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Conversation Reports"}),p.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No saved chats yet. Close a chat to generate and save a report."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-1 space-y-2",children:p.map(t=>e.jsx("button",{onClick:()=>w(t.id),className:`w-full text-left px-3 py-2 rounded-xl border ${u===t.id?"bg-slate-100 dark:bg-slate-800":"bg-white/70 dark:bg-slate-900/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:t.title}),e.jsxs("div",{className:"text-xs text-slate-500",children:[new Date(t.startedAt).toLocaleString()," â†’ ",new Date(t.endedAt).toLocaleTimeString()]})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border",children:"ðŸ’¬ MindMate"})]})},t.id))}),e.jsx("div",{className:"md:col-span-2",children:s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:s.title}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(s.startedAt).toLocaleString()," â€¢ ",s.messages.length," messages"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.report&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700",onClick:D,children:"Download PDF"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700",onClick:L,children:"Send via Email"})]}),e.jsx("button",{className:"text-red-600 text-sm",onClick:()=>R(s.id),children:"Delete"})]})]}),s.report?e.jsxs("div",{className:"rounded-xl border bg-white/70 dark:bg-slate-900/50 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Stress Level:"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${/high/i.test(s.report.stressLevel)?"bg-red-100 text-red-800":/moderate/i.test(s.report.stressLevel)?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s.report.stressLevel})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Nature Summary"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.report.natureSummary})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Thinking Patterns"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.report.thinkingPatterns})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Identified Themes"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:s.report.keyProblems.map((t,l)=>e.jsx("li",{children:t},l))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"General Reflection"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.report.generalReflection})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 dark:bg-blue-900/30 p-3 border",children:[e.jsx("div",{className:"font-semibold text-blue-800 dark:text-blue-100 mb-1",children:"Personalized Wellness Recommendation"}),e.jsx("p",{className:"text-sm text-blue-900/90 dark:text-blue-100/90",children:s.report.wellnessRecommendations})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Disclaimer: AI-generated insights; not a substitute for professional advice."})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"No report found for this chat."}),e.jsxs("div",{className:"rounded-xl border bg-white/70 dark:bg-slate-900/50 p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Messages"}),e.jsx("div",{className:"max-h-[40vh] overflow-y-auto space-y-2 text-sm",children:s.messages.map((t,l)=>e.jsxs("div",{className:`px-3 py-2 rounded-xl ${t.from==="user"?"bg-forest-100 dark:bg-forest-900/30":"bg-slate-100 dark:bg-slate-800/80"}`,children:[e.jsxs("div",{className:"text-xs opacity-60",children:[t.from==="user"?"User":"Bot"," â€¢ ",new Date(t.ts).toLocaleTimeString()]}),e.jsx("div",{className:"whitespace-pre-wrap",children:t.text})]},l))})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Select a chat to view its report and messages."})})]})]})}export{W as default};
